define(["config/menu","jquery","config/config","service","underscore"],function(t,e,o,n,i){function a(){s(),window.location.hash=window.location.hash||o.defaultRoute,"onhashchange"in window&&(void 0===document.documentMode||8==document.documentMode)?(window.onhashchange=d,d()):setInterval(d,200),e("a[href^='#']").die("click").live("click",function(){var t=e(this);return o.CONTENT_MODIFIED.checkChangMethod(),checkFormContentModify(t.attr("href"))})}function s(){setInterval(function(){var o=n.getStatusInfo(),i=t.findMenu();if(0==i.length)return!1;var a=["phonebook/phonebook","sms/smslist"],s=-1!=e.inArray(i[0].path,a);if(!0===i[0].checkSIMStatus){var r="modem_sim_undetected"==o.simStatus||"modem_sim_destroy"==o.simStatus||"modem_waitpin"==o.simStatus||"modem_waitpuk"==o.simStatus,d="modem_imsi_waitnck"==o.simStatus;o.isLoggedIn&&(void 0==e("#div-nosimcard")[0]&&r||void 0==e("#div-network-lock")[0]&&d||(void 0!=e("#div-nosimcard")[0]||void 0!=e("#div-network-lock")[0])&&"modem_init_complete"==o.simStatus)&&u(i[0],o.simStatus,s)}},1e3)}function r(){var t=window.location.hash;if("#login"==t||-1!=i.indexOf(o.GUEST_HASH,t)?e("#themeContainer").attr("style","margin-top:-36px;"):e("#themeContainer").attr("style","margin-top:0px;"),"#login"==window.location.hash)e("#mainContainer").addClass("loginBackgroundBlue");else{var n=e("#mainContainer");n.hasClass("loginBackgroundBlue")&&(e("#container").css({margin:0}),n.removeClass("loginBackgroundBlue").height("auto"))}}function d(){function a(){var t=n.getStatusInfo();void 0==t.simStatus||-1!=e.inArray(t.simStatus,o.TEMPORARY_MODEM_MAIN_STATE)?addTimeout(a,500):(u(d[0],t.simStatus,f),hideLoading())}if(window.location.hash!=m){var s=n.getStatusInfo();if((window.location.hash==o.defaultRoute||-1!=i.indexOf(o.GUEST_HASH,window.location.hash))&&s.isLoggedIn)return void(window.location.hash=""==m?"#home":m);var d=t.findMenu();if(0==d.length)window.location.hash=o.defaultRoute;else{var l=t.findMenu(m);if(m=d[0].hash,"#login"==m&&t.rebuild(),0!=l.length&&d[0].path==l[0].path&&d[0].level!=l[0].level&&"1"!=d[0].level&&"1"!=l[0].level)return;r();var h=["phonebook/phonebook","sms/smslist"],f=-1!=e.inArray(d[0].path,h);!0===d[0].checkSIMStatus||f?void 0==s.simStatus?(showLoading("waiting"),a()):u(d[0],s.simStatus,f):c(d[0])}}}function u(t,o,n){var i={};e.extend(i,t),"modem_sim_undetected"==o||"modem_sim_destroy"==o?n||(i.path="nosimcard"):"modem_waitpin"==o||"modem_waitpuk"==o?i.path="nosimcard":"modem_imsi_waitnck"==o&&(i.path="network_lock"),c(i)}function c(i){clearTimer(),hideLoading();var a="text!tmpl/"+i.path+".html";require([a,i.path],function(i,a){if(h.stop(!0,!0),h.hide(),h.html(i),a.init(),t.refreshMenu(),e("#left, #container").translate(),t.activeSubMenu(),e("form").attr("autocomplete","off"),h.fadeIn(),"FOTA"==o.UPGRADE_TYPE||"OTA"==o.UPGRADE_TYPE){var s=n.getStatusInfo(),r=n.getCurrentUpgradeState(),d=r.current_upgrade_state;if(!s.isLoggedIn){if(!n.getMandatory().is_mandatory)if("upgrade_pack_redownload"==d)showAlertFota("ota_interrupted_alert");else if(""==d){var u=n.getNewVersionState();u.hasNewVersion&&showAlertFota("ota_interrupted_alert")}}}l()})}function l(){var t=e("input:visible:enabled:not(.noDefaultFocus):first","#container").focus(),o=t[0];o&&(t.is(":text")||"TEXTAREA"==o.nodeName.toUpperCase())&&setInsertPos(o,o.value.length)}var m="",h=e("#container");return checkFormContentModify=function(t){return!o.CONTENT_MODIFIED.modified||window.location.hash==t||("sms_to_save_draft"==o.CONTENT_MODIFIED.message?(o.CONTENT_MODIFIED.callback.ok(o.CONTENT_MODIFIED.data),o.resetContentModifyValue(),window.location.hash=t):showConfirm(o.CONTENT_MODIFIED.message,{ok:function(){o.CONTENT_MODIFIED.callback.ok(o.CONTENT_MODIFIED.data),o.resetContentModifyValue(),window.location.hash=t},no:function(){o.CONTENT_MODIFIED.callback.no(o.CONTENT_MODIFIED.data)||(window.location.hash=t,o.resetContentModifyValue())}}),!1)},{init:a}});
//# sourceMappingURL=../sourcemaps/router.js.map
