define(["knockout","jquery","underscore","service","config/config","config/menu","tooltip"],function(e,t,n,o,s,i,a){function r(){function n(){X().isLoggedIn?o.getSMSReady({},function(e){"1"==e.sms_cmd_status_result?window.setTimeout(function(){n()},1e3):z=!0}):window.setTimeout(function(){n()},1e3)}function r(e){t("#statusItemSimStatus").attr("tipTitle","sim_status_"+e.simStatus),e.wifiStatus?0==e.deviceSize?t("#wifi_status").attr("tipTitle","wifi_status_on"):t("#wifi_status").attr("tipTitle","wifi_status"+e.deviceSize):t("#wifi_status").attr("tipTitle","wifi_status_off")}function l(e,n,o,s){e.connectStatus(n),"ppp_connecting"==n?(e.connectStatusTrans("connecting"),e.connectStatusText(t.i18n.prop("connecting"))):checkConnectedStatus(n)?(e.connectStatusTrans("connected"),e.connectStatusText(t.i18n.prop("connected"))):"ppp_disconnecting"==n?(e.connectStatusTrans("disconnecting"),e.connectStatusText(t.i18n.prop("disconnecting"))):o?"connect"==s?(e.connectStatus("wifi_connect"),e.connectStatusTrans("connected"),e.connectStatusText(t.i18n.prop("connected"))):"connecting"==s?(e.connectStatus("wifi_connecting"),e.connectStatusTrans("connecting"),e.connectStatusText(t.i18n.prop("connecting"))):(e.connectStatus("ppp_disconnected"),e.connectStatusTrans("disconnected"),e.connectStatusText(t.i18n.prop("disconnected"))):(e.connectStatusTrans("disconnected"),e.connectStatusText(t.i18n.prop("disconnected")))}function m(){var e=5,t=1;s.dbMsgs&&0!=s.dbMsgs.length||(e=500,t=10),o.getSMSMessages({page:0,smsCount:e,nMessageStoreType:1,tags:t,orderBy:"order by id desc"},function(e){e&&e.messages&&d(e.messages),G=!1})}window.setTimeout(function(){function i(e){o.getSmsCapability({},function(n){var o=!1;0!=n.nvTotal&&n.nvUsed>=n.nvTotal?(t("#sms_unread_count").attr("tipTitle","sms_capacity_is_full"),o=!0):0!=n.nvTotal&&n.nvUsed+5>=n.nvTotal?(t("#sms_unread_count").attr("tipTitle","sms_capacity_will_full"),o=!0):t("#sms_unread_count").attr("tipTitle","sms_unread_count"),a.showSmsDeleteConfirm(o),void 0!==e&&a.smsUnreadCount(e),F=!0})}var a=new c;e.applyBindings(a,t("#statusBar")[0]),window.setInterval(function(){var e=X(),n=t("#h_ssid");e.wifiStatus?n.show():n.hide(),n.html(t.i18n.prop("ssid_title")+":"+e.ssid),a.OTAStatus(e.new_version_state),a.isShowConnectionIcon("CPE"!=s.PRODUCT_TYPE||p(e.opms_wan_mode,e.opms_wan_auto_mode)),a.networkType(getNetworkType(e.networkType)),a.signalCssClass(w(e.signalImg,e.networkType,e.simStatus));var o=!!e.roamingStatus;a.networkOperator(u(e.spn_b1_flag,e.spn_name_data,e.spn_b2_flag,e.networkOperator,o)),a.roamingStatus(e.roamingStatus?"R":""),a.wifiStatusImg(v(e.wifiStatus,e.attachedDevices.length)),a.wifiStatusCssClass(S(e.wifiStatus,e.attachedDevices.length)),a.simStatus(T(e.simStatus)),a.batteryPers(k(e.battery_value,e.batteryStatus)),a.batteryLevel(e.battery_value+"%"),a.pinStatus(e.pinStatus),a.batteryStatus(e.batteryStatus),a.attachedDevices(e.attachedDevices),a.showAttachedDevices(e.wifiStatus),a.isLoggedIn(e.isLoggedIn),s.HAS_SMS&&z&&!b(e.simStatus)&&(!F&&e.isLoggedIn?i(e.smsUnreadCount):a.smsUnreadCount(e.smsUnreadCount)),h(a,e.opms_wan_mode,e.opms_wan_auto_mode,e.dhcp_wan_status,e.connectStatus,e.data_counter,e.connectWifiSSID,e.connectWifiStatus),l(a,e.connectStatus,e.connectWifiSSID,e.connectWifiStatus),checkTrafficLimitAlert(a,e),r({simStatus:e.simStatus,wifiStatus:e.wifiStatus,deviceSize:e.attachedDevices.length,networkType:e.networkType}),a.wifi_5g_enable(e.wifi_5g_enable),E(a.wifi_5g_enable());var c=t("#langLogoBar");e.isLoggedIn?(c.hasClass("langborderBg")||c.addClass("langborderBg"),t("#statusBar:hidden").show()):(c.hasClass("langborderBg")&&c.removeClass("langborderBg"),t("#statusBar:visible").hide()),"AUTO"==e.opms_wan_mode&&void 0!==Q&&""!=Q&&Q!=e.opms_wan_auto_mode&&(Q=e.opms_wan_auto_mode,window.location.reload())},500),s.HAS_SMS&&(window.setInterval(function(){a.isLoggedIn()&&i()},1e4),n()),window.setInterval(function(){if(1==a.isLoggedIn()&&!t("#progress").is(":visible")){var e=X();"connecting_server"!=e.current_upgrade_state&&"upgrading"!=e.current_upgrade_state&&"accept"!=e.current_upgrade_state&&"connect_server_success"!=e.current_upgrade_state||(null==K?(e.is_mandatory||t.modal.close(),y()):0==K&&(K=null))}},1e3);var d=function(){if("FOTA"==s.UPGRADE_TYPE||"OTA"==s.UPGRADE_TYPE){o.getStatusInfo().isLoggedIn?o.getUpgradeResult({},function(e){"success"==e.upgrade_result?I(!0):"fail"==e.upgrade_result?I(!1):window.setTimeout(d,1e3)},function(){window.setTimeout(d,1e3)}):window.setTimeout(d,1e3)}};d(),"TWO_PORTION"==s.UPGRADE_TYPE&&window.setInterval(function(){var e=X();checkConnectedStatus(e.connectStatus)&&e.isLoggedIn&&(s.ALREADY_NOTICE||o.getUpdateInfoWarning({},function(e){2==e.upgrade_notice_flag&&(s.ALREADY_NOTICE=!0,showAlert("update_notice"))}))},6e4);var m=window.setInterval(function(){if(!s.ALREADY_OTA_NOTICE&&s.HAS_OTA_NEW_VERSION&&(q>3&&window.clearInterval(m),q++,checkConnectedStatus(a.connectStatus()))){window.clearInterval(m),s.ALREADY_OTA_NOTICE=!0;var e=X();e.is_mandatory||M(e)}},1e3)},1200),a.init(),checkTrafficLimitAlert=function(e,n){if("#login"==window.location.hash)return!1;var i=s.AP_STATION_SUPPORT?o.getStatusInfo().ap_station_enable:"undefined";if(s.AP_STATION_SUPPORT&&(void 0===i||""===i))return o.refreshAPStationStatus({},t.noop()),!1;i=1==i;var a=t("#confirm-container:visible").length>0,r="CPE"==s.PRODUCT_TYPE&&"PPP"!=n.opms_wan_mode;if(!n.isLoggedIn||a||W&&Y||!n.limitVolumeEnable||!i&&!checkConnectedStatus(n.connectStatus)||r)return!1;if(V)return window.setTimeout(function(){V=!1},2e3),!1;var c=x(n);if(c.showConfirm){var u=null;c.usedPercent>100&&!Y?(W=Y=!0,u={msg:i?"traffic_beyond_msg":"traffic_beyond_disconnect_msg"}):W||(W=!0,Y=!1,u={msg:i?"traffic_limit_msg":"traffic_limit_disconnect_msg",params:[c.limitPercent]}),null!=u&&(i?showAlert(u):showConfirm(u,function(){showLoading("disconnecting"),o.disconnect({},function(e){e.result?successOverlay():errorOverlay()})}))}},getNetworkType=function(e){var n=e.toLowerCase();return""!=n&&"limited service"!=n||(n="limited_service"),"no service"==n&&(n="no_service"),"limited_service"==n||"no_service"==n?(t("#networkType","#statusBar").attr("trans","network_type_"+n),t.i18n.prop("network_type_"+n)):(t("#networkType","#statusBar").removeAttr("trans"),e)},s.HAS_SMS&&i.checkIsMenuExist("sms/smslist")&&(window.setInterval(function(){var e=X();if("#login"!=window.location.hash&&!b(e.simStatus)){for(key in H){var n=H[key];if(t.now()-n>5e3){delete H["m"+n];t(".bubbleItem#m"+n,"#buttom-bubble").fadeOut(1e3,function(){t(this).remove()})}}e.isLoggedIn&&(e.newSmsReceived&&!G&&(G=!0,o.resetNewSmsReceivedVar(),m()),e.smsReportReceived&&(o.resetSmsReportReceivedVar(),_()))}},1e3),s.SMS_DATABASE_SORT_SUPPORT&&window.setInterval(function(){if(i.checkIsMenuExist("sms/smslist")){var e=X();e.isLoggedIn&&z&&!G&&!b(e.simStatus)&&(G=!0,m())}},20001)),s.HAS_SMS&&(t(".bubbleItem","#buttom-bubble").live("mouseover",function(){var e=t(this);delete H[e.attr("id")]}).live("mouseout",function(){var e=t(this),n=t.now();H["m"+n]=n,e.attr("id","m"+n),t(".bubbleItem h3 a.bubbleCloseBtn","#buttom-bubble").data("targetid","m"+n)}),t(".bubbleItem h3 a.bubbleCloseBtn","#buttom-bubble").die().live("click",function(){var e=t(this).data("targetid");delete H[e],t(".bubbleItem#"+e,"#buttom-bubble").fadeOut(1e3,function(){t(this).remove()})}))}function c(){var n=this,i=X(),a=t("#h_ssid");i.wifiStatus?a.show():a.hide(),a.html(t.i18n.prop("ssid_title")+":"+i.ssid),Q=i.opms_wan_auto_mode,n.OTAStatus=e.observable(i.new_version_state),n.isShowConnectionIcon=e.observable(!1),n.hasWifi=e.observable(s.HAS_WIFI),n.hasBattery=e.observable(s.HAS_BATTERY),n.networkType=e.observable(getNetworkType(i.networkType)),n.signalCssClass=e.observable(w(i.signalImg,i.networkType,i.simStatus));var r=!!i.roamingStatus;n.networkOperator=e.observable(u(i.spn_b1_flag,i.spn_name_data,i.spn_b2_flag,i.networkOperator,r)),n.roamingStatus=e.observable(i.roamingStatus?"R":""),n.wifiStatusImg=e.observable(v(i.wifiStatus,i.attachedDevices.length)),n.wifiStatusCssClass=e.observable(S(i.wifiStatus,i.attachedDevices.length)),n.simStatus=e.observable(T(i.simStatus)),n.pinStatus=e.observable(i.pinStatus),n.pinStatusText=e.observable(),n.batteryStatus=e.observable(i.batteryStatus),n.batteryPers=e.observable(k(i.battery_value,i.batteryStatus)),n.batteryLevel=e.observable(i.battery_value+"%"),n.connectStatus=e.observable(i.connectStatus),n.connectStatusText=e.observable(),n.connectStatusTrans=e.observable(),n.attachedDevices=e.observable(i.attachedDevices),n.showAttachedDevices=e.observable(i.wifiStatus),n.isLoggedIn=e.observable(i.isLoggedIn),n.showSmsDeleteConfirm=e.observable(!1),n.smsUnreadCount=e.observable(0),n.connectionCssClass=e.observable(""),h(n,i.opms_wan_mode,i.opms_wan_auto_mode,i.dhcp_wan_status,i.connectStatus,i.data_counter,i.connectWifiSSID,i.connectWifiStatus),n.wifi_5g_enable=e.observable(i.wifi_5g_enable),E(n.wifi_5g_enable());var c=t("#langLogoBar");i.isLoggedIn?(c.hasClass("langborderBg")||c.addClass("langborderBg"),t("#statusBar:hidden").show()):(c.hasClass("langborderBg")&&c.removeClass("langborderBg"),t("#statusBar:visible").hide()),n.connect=function(){showLoading("connecting"),o.connect({},function(e){e.result&&refreshConnectStatus(n,e.status),successOverlay()},function(e){errorOverlay()})},n.disconnect=function(){showLoading("disconnecting"),o.disconnect({},function(e){e.result&&refreshConnectStatus(n,e.status),successOverlay()},function(e){errorOverlay()})}}function u(e,t,n,o,s){return""==t?o:(t=decodeMessage(t),"1"==e&&"1"==n?s?o:t==o?o:t+"  "+o:"1"==e?t==o?o:t+"  "+o:"1"==n?s?o:t:"0"==e&&"0"==n?s?t==o?o:t+"  "+o:t:"")}function d(e){s.dbMsgs||(s.dbMsgs=[]),0==Z.length&&t.each(s.dbMsgs,function(e,t){Z.push(t.id)}),t.each(e,function(e,n){if(-1==t.inArray(n.id,Z))Z.push(n.id),s.dbMsgs.push(n),"1"==n.tag&&m(n,!1);else for(var o=0;o<s.dbMsgs.length;o++)if(s.dbMsgs[o].id==n.id&&s.dbMsgs[o].content!=n.content&&"1"==n.tag){s.dbMsgs[o].content=n.content,m(n,!0);break}}),s.listMsgs=l(s.dbMsgs)}function l(e){var o={},i=[];return s.listMsgs=[],groupDrafts=[],t.each(e,function(e,t){if("4"==t.tag&&""!=t.groupId)return void groupDrafts.push(t);t.target=t.number,parseInt(t.id,10)>s.smsMaxId&&(s.smsMaxId=t.id);var n=getLast8Number(t.number);n in o?o[n].push(t):(o[n]=[t],i.push(t))}),i=n.sortBy(i,function(e){return 0-parseInt(e.id+"",10)}),t.each(i,function(e,t){for(var n=getLast8Number(t.number),i=0,a=!1,r=0;r<o[n].length;r++)o[n][r].isNew&&i++,"4"==o[n][r].tag&&""==o[n][r].groupId&&(a=!0);s.listMsgs.push({id:o[n][0].id,name:"",number:o[n][0].number,latestId:o[n][0].id,totalCount:o[n].length,newCount:i,latestSms:o[n][0].content,latestTime:o[n][0].time,checked:!1,itemId:getLast8Number(n),groupId:o[n][0].groupId,hasDraft:a})}),s.listMsgs}function m(e,n){s.smsMaxId=e.id;var i=t.now();H["m"+i]=i;var a=e.number;$&&s.phonebook&&0==s.phonebook.length&&($=!1,s.HAS_PHONEBOOK?f():s.phonebook=[]);for(l in s.phonebook)if(getLast8Number(s.phonebook[l].pbm_number)==getLast8Number(e.number)){a=s.phonebook[l].pbm_name;break}var r={mark:"m"+i,name:a,title:t.i18n.prop("sms"),titleTrans:"sms",tag:e.tag,content:e.content,datetime:e.time};if(null==ee&&(ee=t.template("newMessagePopTmpl",t("#newMessagePopTmpl"))),t(".bubbleItem:not(.report)","#buttom-bubble").remove(),t.tmpl("newMessagePopTmpl",r).appendTo("#buttom-bubble"),"#sms"==window.location.hash||"#smslist"==window.location.hash){var c=s.currentChatObject&&s.currentChatObject==getLast8Number(e.number),u=getLast8Number(e.number),d=t("#smslist-item-"+u);if(d&&d.length>0){for(var l=0;s.listMsgs&&l<s.listMsgs.length;l++)if(getLast8Number(s.listMsgs[l].number)==getLast8Number(e.number)){s.listMsgs[l].id=e.id,s.listMsgs[l].latestId=e.id,s.listMsgs[l].latestSms=e.content,s.listMsgs[l].latestTime=e.time,n||(s.listMsgs[l].newCount++,s.listMsgs[l].totalCount++);break}if(d.find(".smslist-item-checkbox p.checkbox").attr("id",e.id),d.find(".smslist-item-checkbox input:checkbox").val(e.id).attr("id","checkbox"+e.id),!n){var m=d.find(".smslist-item-total-count").text();if(m=Number(m.substring(1,m.length-1)),d.find(".smslist-item-total-count").text("("+(m+1)+")"),!s.currentChatObject||s.currentChatObject!=getLast8Number(e.number)){var _=d.find(".smslist-item-new-count").removeClass("hide");_&&_.text().length>0?_.text(Number(_.text())+1):_.text(1)}}var p=d.find(".smslist-item-msg pre").text(e.content);s.currentChatObject&&s.currentChatObject==getLast8Number(e.number)?p.removeClass("txtBold"):p.addClass("txtBold"),d.find(".smslist-item-repeat span").die().click(function(){forwardClickHandler(e.id)}),d.find("span.clock-time").text(e.time);var g=d;d.hide().remove(),t("#smslist_container").prepend(g.show())}else{var w="";if(s.phonebook&&s.phonebook.length>0)for(l in s.phonebook)if(getLast8Number(s.phonebook[l].pbm_number)==getLast8Number(e.number)){w=s.phonebook[l].pbm_name;break}var b={id:e.id,name:w,number:e.number,latestId:e.id,totalCount:1,newCount:c?0:1,latestSms:e.content,latestTime:e.time,checked:!1,hasDraft:!1,itemId:getLast8Number(e.number)};null==J&&(J=t.template("smsListTmpl",t("#smsListTmpl"))),t.tmpl("smsListTmpl",{data:[b]}).prependTo("#smslist_container")}if(s.HAS_PHONEBOOK?t(".sms-add-contact-icon").removeClass("hide"):t(".sms-add-contact-icon").addClass("hide"),c){var h=t("#talk-item-"+e.id,"#chatlist");h&&h.length>0?(t(".J_content pre",h).html(dealContent(e.content)),t(".time .smslist-item-time",h).text(e.time),t(".smslist-item-repeat",h).die().click(function(){forwardClickHandler(e.id)}),t(".smslist-item-delete",h).die().click(function(){deleteSingleItemClickHandler(e.id)})):(t("#smsOtherTmpl").tmpl(e).appendTo("#chatlist"),t(".clear-container","#chatpanel").animate({scrollTop:t("#chatlist").height()})),s.SMS_SET_READ_WHEN_COMPLETE?s.SMS_SET_READ_WHEN_COMPLETE&&e.receivedAll&&o.setSmsRead({ids:[e.id]},t.noop):o.setSmsRead({ids:[e.id]},t.noop)}enableCheckbox(t("#smslist-checkAll"))}}function _(){$&&s.phonebook&&0==s.phonebook.length&&($=!1,s.HAS_PHONEBOOK?f():s.phonebook=[]),o.getSMSDeliveryReport({page:0,smsCount:10},function(e){var n=e.messages,o=[];t.each(n,function(e,n){-1==t.inArray(n.number,o)&&(o.push(n.number),window.setTimeout(function(){var o=t.now();H["m"+o]=o,n.name=n.number;for(e in s.phonebook)if(getLast8Number(s.phonebook[e].pbm_number)==getLast8Number(n.number)){n.name=s.phonebook[e].pbm_name;break}var i=t.i18n.prop("sms_delivery_report_"+n.content),a={mark:"m"+o,name:n.name,title:t.i18n.prop("sms_report"),titleTrans:"sms_report",content:i,datetime:n.time,report:"report"};null==ee&&(ee=t.template("newMessagePopTmpl",t("#newMessagePopTmpl"))),t(".report","#buttom-bubble").remove(),t.tmpl("newMessagePopTmpl",a).appendTo("#buttom-bubble")},100))})},function(){})}function f(){g(o.getPhoneBooks({page:0,data_per_page:2e3,orderBy:"id",isAsc:!1}))}function p(e,t){return"AUTO"!=e?"STATIC"!=e&&"DHCP"!=e:"AUTO_DHCP"!=t}function g(e){t.isArray(e.pbm_data)&&e.pbm_data.length>0&&(s.phonebook=e.pbm_data)}function w(e,t,n){return t=t.toLowerCase(),n=n?n.toLowerCase():"",""!=t&&"limited_service"!=t&&"no_service"!=t&&"limited service"!=t&&"no service"!=t&&"modem_init_complete"==n||(e="_none"),"signal signal"+e}function b(e){return"modem_sim_undetected"==e||"modem_undetected"==e||"modem_sim_destroy"==e||"modem_waitpin"==e||"modem_waitpuk"==e||"modem_imsi_waitnck"==e}function h(e,t,n,s,i,a,r,c){var u="icon_connection ";if("AUTO"==t&&"AUTO_DHCP"==n)u+="1"==s?"connectionNone":"disconnect";else if("ppp_disconnected"==i){if(r&&"connect"==c)return void o.getHotspotList({},function(t){for(var n="icon_connection ",o="connecting ",s=0,i=t.hotspotList.length;s<i;s++)if("1"==t.hotspotList[s].connectStatus){o="wifi_connected";break}n+=o,e.connectionCssClass(n)});u+=r&&"connecting"==c?"connecting":"disconnect"}else"ppp_connecting"==i||"wifi_connecting"==i?u+="connecting":checkConnectedStatus(i)?"0"!=a.uploadRate&&"0"!=a.downloadRate?u+="connectionBoth":"0"!=a.uploadRate&&"0"==a.downloadRate?u+="connectionUp":"0"==a.uploadRate&&"0"!=a.downloadRate?u+="connectionDown":u+="connectionNone":u+="disconnect";e.connectionCssClass(u)}function v(e,t){return e?0==t?"./img/wifi0.png":"./img/wifi"+t+".png":"./img/wifi_off.png"}function S(e,t){return e?0==t?"wifi_status0":"wifi_status"+t:"wifi_status_off"}function T(e){var t;switch(e){case"modem_init_complete":t="./img/sim_detected.png";break;case"modem_waitpin":case"modem_waitpuk":case"modem_sim_undetected":case"modem_undetected":case"modem_imsi_waitnck":case"modem_sim_destroy":case"modem_destroy":t="./img/sim_undetected.png";break;default:t="./img/sim_detected.png"}return t}function k(e,t){var n=parseInt(e);return"0"==t?n>=0&&n<=5?"img/battery_out.png":n>5&&n<=25?"img/battery_one.png":n>25&&n<=50?"img/battery_two.png":n>50&&n<100?"img/battery_three.png":"img/battery_full.png":"2"==t?"img/battery_full.png":"img/battery_charging.gif"}function I(e){if(t("#loading").is(":visible")||t("#confirm").is(":visible"))window.setTimeout(function(){I(e)},1e3);else{var n=e?"ota_update_success":"ota_update_failed";showAlertFota(n,function(){"OTA"==s.UPGRADE_TYPE&&o.clearUpdateResult({},t.noop())})}}function P(){"low_battery"==o.getCurrentUpgradeState().current_upgrade_state&&(showInfo("ota_low_battery"),clearInterval(te))}function y(){function e(){var n=["upgrade_pack_redownload","upgrade_prepare_install","low_battery","connecting_server","connect_server_success","upgrading","accept"],s=o.getCurrentUpgradeState();"fota_idle"==s.current_upgrade_state.toLowerCase()?addTimeout(e,1e3):-1!=t.inArray(s.current_upgrade_state,n)&&(hideLoading(),N())}K=!0,t("#progress").is(":visible")||e();var n=0,s=function(){var e=null;n<=3?(n+=1,e=o.getCurrentUpgradeState()):e=X();var t=e.current_upgrade_state;if(K){if("connecting_server"==t);else{if("connect_server_failed"==t)return K=!1,window.clearTimeout(ne),hideProgressBar(),void showAlert("ota_connect_server_failed");if("connect_server_success"==t);else if("upgrading"==t)C();else if("download_success"==t);else if("upgrade_pack_check_ok"==t);else{if("download_failed"==t)return hideProgressBar(),K=!1,showAlert("ota_download_failed"),void window.clearTimeout(ne);if("server_unavailable"==t)return hideProgressBar(),K=!1,showAlert("ota_connect_server_failed"),void window.clearTimeout(ne);if("network_unavailable"==t)return hideProgressBar(),K=!1,showAlert("ota_no_network"),void window.clearTimeout(ne);if("pkg_exceed"==t)return hideProgressBar(),K=!1,showAlert("ota_pkg_exceed"),void window.clearTimeout(ne);if("accept"==t);else{if("low_battery"==t)return hideProgressBar(),K=!1,showInfo("ota_low_battery"),void window.clearTimeout(ne);if("upgrade_pack_error"==t)return hideProgressBar(),K=!1,showInfo("ota_md5_error"),void window.clearTimeout(ne);if("upgrade_prepare_install"==t)return hideProgressBar(),K=!1,o.removeTimerThings("current_upgrade_state",function(){}),showInfoFota("ota_download_success"),window.clearTimeout(ne),void(te=setInterval(function(){P()},1e3));if("checking"==t||"fota_idle"==t);else if("upgrade_pack_redownload"!=t)return K=!1,hideProgressBar(),void window.clearTimeout(ne)}}}ne=window.setTimeout(s,1e3)}};K?ne=window.setTimeout(s,100):window.clearTimeout(ne)}function O(e){var t=o.getUserChoice();if(e){var n=X();if(!checkConnectedStatus(n.connectStatus)&&"connect"!=n.connectWifiStatus)return void showAlert("ota_network_disconnected");"none"==t.if_has_select?A():"accept"==t.if_has_select?y():"cancel"==t.if_has_select?showAlert("ota_have_cancel"):"downloading_cancel"==t.if_has_select&&showAlert("ota_have_cancel")}else"none"==t.if_has_select?L():"accept"==t.if_has_select?y():"cancel"==t.if_has_select||t.if_has_select}function C(){o.getPackSizeInfo({},function(e){var n;n=0==parseInt(e.pack_total_size)?0:parseInt(100*parseInt(e.download_size)/parseInt(e.pack_total_size)),n>100&&(n=100),n>0&&(n>95&&showProgressBar("ota_update_progress","<br/>"+t.i18n.prop("ota_update_warning")),setProgressBar(n))})}function A(){o.setUpgradeSelectOp({selectOp:"1"},function(e){"success"==e.result&&y()})}function L(){o.setUpgradeSelectOp({selectOp:"0"},function(e){})}function N(){if(o.getMandatory().is_mandatory)showProgressBar("ota_update_progress","<br/>"+t.i18n.prop("ota_update_warning"));else{var e="";"OTA"==s.UPGRADE_TYPE&&(e="<br/><br/><button id='btnStopUpgrade' onclick='stopOTAUpgrade();' class='btn-1 btn-primary'>"+t.i18n.prop("cancel")+"</button>"),showProgressBar("ota_update_progress","<br/>"+t.i18n.prop("ota_update_warning")+e)}setProgressBar(0)}function M(e){var n=e.current_upgrade_state;if("upgrade_pack_redownload"==n)showConfirm("ota_interrupted",{ok:function(){O(1)},no:function(){O(0)}});else{var s=["upgrade_prepare_install","low_battery","connecting_server","connect_server_success","upgrading","accept"];if(-1!=t.inArray(n,s))y();else{var i=o.getNewVersionInfo(),a="";i.version&&(a="<br/>"+t.i18n.prop("ota_version")+i.version),showConfirmFota(t.i18n.prop("ota_new_version")+a,{ok:function(){O(1)},no:function(){O(0)}})}}}function B(e){W=!!e,Y=!!e,e||(V=!0)}function R(e){Y=!!e,e||(V=!0)}function x(e){var t={showConfirm:!1,limitPercent:e.limitVolumePercent};if("1"==e.limitVolumeType){var n=parseInt(e.data_counter.monthlySent,10)+parseInt(e.data_counter.monthlyReceived,10);t.usedPercent=n/e.limitVolumeSize*100,t.usedPercent>t.limitPercent&&(t.showConfirm=!0,t.type="data")}else t.usedPercent=e.data_counter.monthlyConnectedTime/e.limitVolumeSize*100,t.usedPercent>t.limitPercent&&(t.showConfirm=!0,t.type="time");return t}function E(e){function t(){var e=o.getStatusInfo();"0"==e.radio_off||"1"==e.radio_off?successOverlay():n<=20?(n+=1,addTimeout(function(){t()},2e3)):successOverlay()}if("0"==e){var n=0;o.getWifiAdvance({},function(e){if("a"==e.wifiBand){var n={};n.name="wifi_5g_enable",n.value="1",o.setNV(n,function(){showConfirm("wifi_5g_enalbe_alert",function(){showLoading(),o.setWifiBand({wifiEnabled:"1",wifi_band:"b"},function(e){"success"==e.result?setTimeout(function(){t()},2e3):errorOverlay()})})})}})}}function U(){var e=window.location.href;if(-1!=e.indexOf("?no_connect")){var t=o.getStatusInfo();"PPPOE"==t.opms_wan_mode||"AUTO"==t.opms_wan_mode&&"AUTO_PPPOE"==t.opms_wan_auto_mode?window.location.href=e.slice(0,e.indexOf("?no_connect"))+"#net_setting":window.location.href=e.slice(0,e.indexOf("?no_connect"))+"#home"}else-1!=e.indexOf("?flow_beyond")?window.location.href=e.slice(0,e.indexOf("?flow_beyond"))+"#traffic_alert":-1!=e.indexOf("?fota_upgrade")?window.location.href=e.slice(0,e.indexOf("?fota_upgrade"))+"#ota_update":window.location.hash="#home"}function D(){if("#login"!=window.location.hash){var e=window.location.href;window.location.href=e.slice(0,e.indexOf("?no_connect"))+"#home"}}function j(e){var t=o.getStatusInfo(),n=window.location.href;-1!=window.location.href.indexOf("?no_connect")?"PPPOE"==t.opms_wan_mode||"AUTO"==t.opms_wan_mode&&"AUTO_PPPOE"==t.opms_wan_auto_mode?e?showPromptNoImg("pppoe_error_jump_login",function(){window.location.href=n.slice(0,n.indexOf("?no_connect"))+"#net_setting"}):showPromptNoImg("pppoe_error_jump"):"modem_init_complete"==t.simStatus?"0"==t.ppp_dial_conn_fail_counter||""==t.ppp_dial_conn_fail_counter?e?showPromptNoImg("no_connect_jump_login",function(){D()}):showPromptNoImg("no_connect_jump"):e?showPromptNoImg("connect_failed_jump_login",function(){D()}):showPromptNoImg("connect_failed_jump"):"modem_sim_undetected"==t.simStatus?showPromptNoImg("no_simcard_jump",function(){D()}):"modem_sim_destroy"==t.simStatus||"modem_destroy"==t.simStatus?showPromptNoImg("invalid_simcard_jump",function(){D()}):"modem_imsi_waitnck"==t.simStatus||"modem_waitpin"==t.simStatus||"modem_waitpuk"==t.simStatus?e?showPromptNoImg("locked_simcard_jump_login",function(){D()}):showPromptNoImg("locked_simcard_jump"):e?showPromptNoImg("connect_failed_jump_login",function(){D()}):showPromptNoImg("connect_failed_jump"):-1!=window.location.href.indexOf("?flow_beyond")?e?showPromptNoImg("flow_beyond_jump_login",function(){o.setRedirectOff(),window.location.href=n.slice(0,n.indexOf("?flow_beyond"))+"#traffic_alert"}):showPromptNoImg("flow_beyond_jump",function(){o.setRedirectOff()}):-1!=window.location.href.indexOf("?fota_upgrade")&&(e?showPromptNoImg("fota_upgrade_jump_login",function(){o.setRedirectOff(),window.location.href=n.slice(0,n.indexOf("?fota_upgrade"))+"#ota_update"}):showPromptNoImg("fota_upgrade_jump",function(){o.setRedirectOff()}))}var H={},W=!1,Y=!1,V=!1,z=!1,F=!1,G=!1,K=null,q=0,J=null,Q="",X=function(){return o.getStatusInfo()},Z=[],$=!0,ee=null;gotoSmsList=function(){var e="#sms";"#sms"==window.location.hash&&(e="#smslist"),checkFormContentModify(e)&&(window.location.hash=e)};var te=0,ne=0;return showOTAAlert=function(){if(o.getMandatory().is_mandatory)y();else{var e={};e=o.getCurrentUpgradeState(),M(e)}},stopOTAUpgrade=function(){o.setUpgradeSelectOp({selectOp:"2"},function(e){}),K=!1,window.clearTimeout(ne),hideLoading(),showAlert("ota_cancel")},{init:r,setTrafficAlertPopuped:B,setTrafficAlert100Popuped:R,getTrafficResult:x,showOTAAlert:showOTAAlert,gotoRelevantHashByFlag:U,setRedirectTips:j}});
//# sourceMappingURL=../../sourcemaps/status/statusBar.js.map
